# Pre-commit hooks that delegate to Makefile targets
# This ensures CI and local development use the same formatting/linting logic
repos:
  - repo: local
    hooks:
      - id: fmt
        name: Format code (Go, protobuf, jsonnet)
        entry: make fmt
        language: system
        pass_filenames: false
        # Run on any file change - make fmt handles file filtering internally
        always_run: true

      - id: generate
        name: Check generated protobuf files
        entry: make generate check/unstaged-changes
        language: system
        pass_filenames: false
        # Only run when protobuf-related files in api/ or pkg/ are staged
        # This matches: api/**/*.proto, pkg/**/*.proto, api/buf*.yaml, pkg/buf*.yaml
        # Root-level YAML files (renovate.json, .golangci.yml, etc.) are excluded
        files: '^(api|pkg)/.*\.(proto|yaml)$'
